<!DOCTYPE html>
<html lang="vi">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Lofi Music</title>
		<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		<style>
			/* T√πy ch·ªânh m√†u n·ªÅn c·ªßa SweetAlert */
			.swal2-popup {
				background-color: #1f2937 !important;
				color: #f3f4f6;
			}
			.swal2-title,
			.swal2-content,
			.swal2-confirm {
				color: #f3f4f6 !important;
			}
		</style>
	</head>
	<body class="bg-gray-800 text-white font-sans text-center p-5">
		<h1 class="text-3xl font-bold mb-6 flex items-center justify-center space-x-3 text-gray-100">
			<span>üéß</span>
			<span>Tr√¨nh Nghe Nh·∫°c</span>
		</h1>

		<!-- N√∫t ƒëi·ªÅu khi·ªÉn -->
		<div class="mb-5 flex flex-row justify-center items-center space-x-2">
			<button onclick="playNext()" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 transition">Ti·∫øp</button>
			<button onclick="toggleRepeat()" id="repeatBtn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 transition">üîÑ<span id="repeatStatus">T·∫Øt</span></button>
			<button onclick="toggleRandom()" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 transition">üé≤<span id="mode">Ng·∫´u nhi√™n</span></button>
		</div>

		<!-- Player Container -->
		<div id="playerContainer" class="w-full max-w-lg mx-auto rounded-lg bg-black overflow-hidden"></div>

		<!-- Hi·ªÉn th·ªã b√†i h√°t hi·ªán t·∫°i -->
		<div id="currentSong" class="mt-4 mb-5 flex items-center justify-center space-x-3 text-lg bg-gray-700 p-3 rounded-xl shadow-lg max-w-md mx-auto"></div>

		<!-- N√∫t ƒëi·ªÅu khi·ªÉn playlist v√† y√™u th√≠ch -->
		<div class="flex justify-center space-x-2 mb-4">
			<button id="togglePlaylistBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition">·∫®n playlist</button>
			<button onclick="toggleFavorites()" class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded transition"><span class="text-xl">‚ù§Ô∏è</span></button>
			<button id="favoriteRandomBtn" onclick="toggleFavoriteRandom()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded transition"><span class="text-xl">üé≤</span><span id="favoriteRandomStatus">T·∫Øt</span></button>
		</div>

		<!-- Playlist Wrapper -->
		<div id="playlistWrapper">
			<ul id="playlist" class="mt-6 max-w-lg mx-auto bg-gray-700 rounded-lg shadow divide-y divide-gray-600 text-left"></ul>
			<div id="pagination" class="flex justify-center items-center space-x-2 mt-4"></div>
		</div>

		<!-- Modal danh s√°ch y√™u th√≠ch -->
		<div id="favoritesModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
			<div class="bg-gray-800 p-6 rounded-lg max-w-md w-full relative">
				<button onclick="closeFavorites()" class="absolute top-2 right-2 text-gray-300 hover:text-white">‚úï</button>
				<h2 class="text-2xl mb-4">Danh s√°ch y√™u th√≠ch</h2>
				<ul id="favoritesList" class="divide-y divide-gray-600"></ul>
			</div>
		</div>

		<script>
			const musicList = [
				"music/1.mp3",
				"music/2.mp3",
				"music/3.mp3",
				"music/4.mp3",
				"music/5.mp3",
				"music/6.mp3",
				"music/7.mp3",
				"music/8.mp3",
				"music/9.mp3",
				"music/10.mp3",
				"music/11.mp3",
				"music/12.mp3",
				"music/13.mp3",
				"music/14.mp3",
				"music/15.mp3",
				"music/16.mp3",
				"music/17.mp3",
				"music/18.mp3",
				"music/19.mp3",
				"music/20.mp3",
				"music/21.mp3",
				"music/22.mp3",
				"music/24.mp3",
				"music/25.mp3",
				"music/26.mp3",
				"music/27.mp3",
				"music/28.mp3",
				"music/29.mp3",
				"music/30.mp3",
				"music/31.mp3",
				"music/32.mp3",
				"music/33.mp3",
				// Th√™m link YouTube v√≠ d·ª•:
				"https://www.youtube.com/embed/lqFGzPM8wkg",
				"https://www.youtube.com/embed/xi1cWsfJTTs",
				"https://www.youtube.com/embed/uXkYCdL_HpY",
			];

			const songNames = [
				"Th√°p R∆°i T·ª± Do",
				"Gh√©p H√¨nh T√¨nh Y√™u",
				"G√≥p Vui",
				"Kiss Kiss Shy Shy",
				"Nh∆∞",
				"B·∫•t C√¥ng",
				"CocoCoCo",
				"Magnetic",
				"S∆°n H·∫£i",
				"Nh·∫≠p Ho√†i",
				"Kh√¥ng N·ª° - ƒê·∫•u La ƒê·∫°i L·ª•c",
				"C√≥ - Kh√¥ng C√≥",
				"ƒê·ªëi Di·ªán",
				"Tham C·∫ßu - Th·∫ßn ·∫®n",
				"Ring Ring Ring",
				"TA - B√†n H·ªï",
				"Nh∆∞ Ca - Li·ªát H·ªèa Nh∆∞ Ca",
				"C√°i ƒêu√¥i Nh·ªè",
				"L∆∞u Chuy·ªÉn Doanh H·ªìi - Ng·ªô Long",
				"ƒê√¥ng Mi√™n",
				"Polaroid Love",
				"For ya ‚Äì T∆∞·ªüng Ti·ªÉu Ni",
				"Say YES",
				"Ch·ªù ƒê·∫øn Th√°ng 13",
				"M√¨nh C√πng Nhau ƒê√≥ng BƒÉng",
				"Trang Gi·∫•y Cu·ªëi C√πng",
				"Blueming - IU",
				"Y√™u Nh∆∞ Th·∫ø - Th·∫ßn ·∫®n",
				"B√≠ch Th∆∞∆°ng Chi·∫øn Ca - D·ªØ Ph∆∞·ª£ng H√†nh",
				"Phong - Thi·∫øu Ni√™n Ca H√†nh",
				"D·ªØ Qu√¢n Quy - R·∫•t Nh·ªõ R·∫•t Nh·ªõ Anh",
				"Ch∆∞a Ch·∫Øc - Ng√¥ C·∫©n Ng√¥n",
				// T√™n b√†i cho YouTube link
				"H·ªçc b√†i v√† nghe nh·∫°c c√πng t·ªõ nh√©",
				"D·ªØ Ph∆∞·ª£ng H√†nh OST",
				"Playlist Nh·∫°c H√®",
			];

			let currentIndex = 0;
			let isRandom = true;
			let isFavoriteRandom = false;
			let currentPage = 1;
			const pageSize = 10;
			let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");

			const playerContainer = document.getElementById("playerContainer");
			const modeSpan = document.getElementById("mode");
			const currentSongDisplay = document.getElementById("currentSong");
			const playlist = document.getElementById("playlist");
			const playlistWrapper = document.getElementById("playlistWrapper");
			const togglePlaylistBtn = document.getElementById("togglePlaylistBtn");

			function renderPlaylist() {
				playlist.innerHTML = "";
				const start = (currentPage - 1) * pageSize;
				const end = Math.min(start + pageSize, songNames.length);

				for (let idx = start; idx < end; idx++) {
					const name = songNames[idx];
					const url = musicList[idx];
					const isFavorite = favorites.includes(url);

					const li = document.createElement("li");
					li.className = "flex items-center justify-between px-4 py-2 hover:bg-gray-600 transition " + (idx === currentIndex ? "bg-gray-500 font-bold" : "");

					const songContainer = document.createElement("div");
					songContainer.className = "flex items-center space-x-2";
					let icon = "üéµ";
					if (url.includes("youtube.com") || url.includes("youtu.be")) icon = "‚ñ∂Ô∏è";
					else if (url.endsWith(".mp3")) icon = "üé∂";
					else if (url.endsWith(".mp4")) icon = "üé¨";
					songContainer.innerHTML = `<span class="text-xl">${icon}</span><span>${name}</span>`;
					li.appendChild(songContainer);

					const favoriteBtn = document.createElement("button");
					favoriteBtn.className = "text-xl hover:text-pink-500 transition";
					favoriteBtn.innerHTML = isFavorite ? "‚ù§Ô∏è" : "ü§ç";
					favoriteBtn.onclick = (event) => {
						event.stopPropagation();
						toggleFavorite(idx);
					};
					li.appendChild(favoriteBtn);

					li.onclick = (event) => {
						if (event.target !== favoriteBtn) {
							currentIndex = idx;
							play(currentIndex);
							renderPlaylist();
						}
					};
					playlist.appendChild(li);
				}
				renderPagination();
			}

			function renderPagination() {
				const pagination = document.getElementById("pagination");
				pagination.innerHTML = "";
				const totalPages = Math.ceil(songNames.length / pageSize);

				const prevBtn = document.createElement("button");
				prevBtn.textContent = "¬´";
				prevBtn.disabled = currentPage === 1;
				prevBtn.className = "px-2 py-1 rounded bg-gray-600 hover:bg-gray-500 disabled:opacity-50";
				prevBtn.onclick = () => {
					if (currentPage > 1) {
						currentPage--;
						renderPlaylist();
					}
				};
				pagination.appendChild(prevBtn);

				for (let i = 1; i <= totalPages; i++) {
					const pageBtn = document.createElement("button");
					pageBtn.textContent = i;
					pageBtn.className = "px-2 py-1 rounded " + (i === currentPage ? "bg-blue-500 text-white" : "bg-gray-600 hover:bg-gray-500");
					pageBtn.onclick = () => {
						currentPage = i;
						renderPlaylist();
					};
					pagination.appendChild(pageBtn);
				}

				const nextBtn = document.createElement("button");
				nextBtn.textContent = "¬ª";
				nextBtn.disabled = currentPage === totalPages;
				nextBtn.className = "px-2 py-1 rounded bg-gray-600 hover:bg-gray-500 disabled:opacity-50";
				nextBtn.onclick = () => {
					if (currentPage < totalPages) {
						currentPage++;
						renderPlaylist();
					}
				};
				pagination.appendChild(nextBtn);
			}

			function play(index) {
				const url = musicList[index];
				currentPage = Math.floor(index / pageSize) + 1;
				playerContainer.innerHTML = "";

				if (url.includes("youtube.com") || url.includes("youtu.be")) {
					const iframe = document.createElement("iframe");
					iframe.src = url + "?autoplay=1";
					iframe.width = "100%";
					iframe.height = "315";
					iframe.frameBorder = "0";
					iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
					iframe.allowFullscreen = true;
					playerContainer.appendChild(iframe);
				} else {
					const video = document.createElement("video");
					video.src = url;
					video.controls = true;
					video.playsInline = true;
					video.autoplay = true;
					video.className = "w-full";
					video.volume = 0.5;
					video.addEventListener("ended", function () {
						if (isRepeat) play(currentIndex);
						else playNext();
					});
					playerContainer.appendChild(video);
				}

				let icon = "üéµ";
				if (url.includes("youtube.com") || url.includes("youtu.be")) icon = "‚ñ∂Ô∏è";
				else if (url.endsWith(".mp3")) icon = "üé∂";
				else if (url.endsWith(".mp4")) icon = "üé¨";
				currentSongDisplay.innerHTML = `<span class="text-2xl">${icon}</span> <span>${songNames[index]}</span>`;

				renderPlaylist();
			}
			let isRepeat = false;

			function toggleRepeat() {
				isRepeat = !isRepeat;
				document.getElementById("repeatStatus").textContent = isRepeat ? "B·∫≠t" : "T·∫Øt";
			}

			function playNext() {
				if (isFavoriteRandom && favorites.length > 0) {
					let nextIndex;
					do {
						const randomPos = Math.floor(Math.random() * favorites.length);
						nextIndex = musicList.indexOf(favorites[randomPos]);
					} while (favorites.length > 1 && nextIndex === currentIndex);
					currentIndex = nextIndex;
				} else if (isRandom) {
					let nextIndex;
					const nonYoutubeIndexes = musicList.map((item, idx) => (!item.includes("youtube.com") && !item.includes("youtu.be") ? idx : -1)).filter((idx) => idx !== -1);
					do {
						const randomPos = Math.floor(Math.random() * nonYoutubeIndexes.length);
						nextIndex = nonYoutubeIndexes[randomPos];
					} while (nonYoutubeIndexes.length > 1 && nextIndex === currentIndex);
					currentIndex = nextIndex;
				} else {
					currentIndex = (currentIndex + 1) % musicList.length;
				}
				play(currentIndex);
			}

			function toggleRandom() {
				isRandom = !isRandom;
				modeSpan.textContent = isRandom ? "Ng·∫´u nhi√™n" : "Tu·∫ßn t·ª±";
			}

			// Y√™u th√≠ch
			function toggleFavorite(index) {
				const url = musicList[index];
				const isFavorite = favorites.includes(url);
				if (isFavorite) {
					favorites = favorites.filter((song) => song !== url);
				} else {
					favorites.push(url);
				}
				localStorage.setItem("favorites", JSON.stringify(favorites));
				renderPlaylist();
				updateFavoritesList();
			}
			function toggleFavorites() {
				const modal = document.getElementById("favoritesModal");
				modal.classList.toggle("hidden");
				updateFavoritesList();
			}
			function closeFavorites() {
				document.getElementById("favoritesModal").classList.add("hidden");
			}
			function updateFavoritesList() {
				const favoritesList = document.getElementById("favoritesList");
				favoritesList.innerHTML = "";
				favorites.forEach((url) => {
					const index = musicList.indexOf(url);
					if (index !== -1) {
						const name = songNames[index];
						const li = document.createElement("li");
						li.className = "flex items-center justify-between px-4 py-2 hover:bg-gray-600 transition";
						li.innerHTML = `<span>${name}</span>
							<button onclick="play(${index})" class="text-xl hover:text-blue-500 transition">‚ñ∂Ô∏è</button>`;
						favoritesList.appendChild(li);
					}
				});
			}

			function toggleFavoriteRandom() {
				if (favorites.length === 0) {
					Swal.fire({
						icon: "warning",
						title: "Danh s√°ch tr·ªëng",
						text: "Vui l√≤ng th√™m b√†i h√°t v√†o danh s√°ch y√™u th√≠ch tr∆∞·ªõc!",
						confirmButtonText: "ƒê√≥ng",
					});
					return;
				}
				isFavoriteRandom = !isFavoriteRandom;
				document.getElementById("favoriteRandomStatus").textContent = isFavoriteRandom ? "B·∫≠t" : "T·∫Øt";
			}

			// ·∫®n/hi·ªán playlist
			let isPlaylistVisible = false; // M·∫∑c ƒë·ªãnh ·∫©n
			playlistWrapper.style.display = "none";
			togglePlaylistBtn.textContent = "Hi·ªán";
			togglePlaylistBtn.onclick = function () {
				isPlaylistVisible = !isPlaylistVisible;
				playlistWrapper.style.display = isPlaylistVisible ? "block" : "none";
				togglePlaylistBtn.textContent = isPlaylistVisible ? "·∫®n" : "Hi·ªán";
			};

			// Kh·ªüi ƒë·ªông trang
			modeSpan.textContent = isRandom ? "Ng·∫´u nhi√™n" : "Tu·∫ßn t·ª±";
			document.getElementById("favoriteRandomStatus").textContent = isFavoriteRandom ? "B·∫≠t" : "T·∫Øt";
			renderPlaylist();

			// ƒê·∫£m b·∫£o c·∫≠p nh·∫≠t l·∫°i danh s√°ch y√™u th√≠ch khi load l·∫°i trang
			window.addEventListener("storage", function () {
				favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
				renderPlaylist();
				updateFavoritesList();
			});
		</script>
	</body>
</html>
